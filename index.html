<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Talking Cat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Animations & Keyframes --- */
        @keyframes breathe { 0%, 100% { transform: scaleY(1) scaleX(1); } 50% { transform: scaleY(1.02) scaleX(0.98); } }
        @keyframes blink { 0%, 96%, 100% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
        @keyframes tailWag { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(15deg); } }
        @keyframes chew { 0% { transform: translateY(0); } 25% { transform: translateY(5px) scaleY(0.9); } 50% { transform: translateY(0); } 75% { transform: translateY(5px) scaleY(0.9); } 100% { transform: translateY(0); } }
        @keyframes jump { 0% { transform: translateY(0); } 40% { transform: translateY(-80px) scaleX(0.9); } 100% { transform: translateY(0); } }
        @keyframes floatItem { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100px) rotate(20deg); opacity: 0; } }
        @keyframes waterFlow { 0% { stroke-dashoffset: 20; } 100% { stroke-dashoffset: 0; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        body { touch-action: none; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        .cat-idle { animation: breathe 4s infinite ease-in-out; transform-origin: bottom center; }
        .cat-eye-anim { animation: blink 4s infinite; transform-origin: center; }
        .cat-tail-anim { animation: tailWag 3s infinite ease-in-out; transform-origin: bottom left; }
        .chewing .cat-jaw { animation: chew 0.3s infinite; }
        .talking .cat-mouth-inner { animation: openMouth 0.2s infinite alternate; }
        @keyframes openMouth { from { ry: 2; } to { ry: 10; } }
        
        .dirt-spot { transition: opacity 1s; }
        .shower-active .water-stream { display: block; }
        
        /* Stats Bar */
        .stat-bar-fill { transition: width 0.5s, background-color 0.5s; }

        /* Floating Items (Food/Hearts) */
        .floater { position: absolute; animation: floatItem 1.5s forwards; pointer-events: none; z-index: 50; }

        /* Scenery Transitions */
        #game-bg { transition: background 0.5s; }
    </style>
</head>
<body class="bg-gray-900 h-screen w-screen flex flex-col items-center justify-between select-none">

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 z-50 bg-sky-400 flex flex-col items-center justify-center p-6 text-white text-center">
        <div class="text-6xl mb-4">üê±</div>
        <h1 class="text-4xl font-bold mb-2 text-yellow-300 drop-shadow-md">My Talking Cat</h1>
        <p class="mb-8 text-lg opacity-90">Talk, Feed, Bathe & Play!</p>
        <button id="start-btn" class="bg-white text-sky-500 text-2xl font-bold py-4 px-10 rounded-full shadow-lg hover:scale-105 transition active:scale-95 animate-bounce">
            TAP TO PLAY
        </button>
        <p class="mt-4 text-xs opacity-70">Please allow Microphone access when asked</p>
    </div>

    <!-- UI Stats Header -->
    <div id="ui-header" class="w-full max-w-md p-4 flex gap-2 justify-between items-center z-20 pt-8 hidden">
        <div class="flex flex-col items-center w-1/4">
            <span class="text-xl mb-1">üçó</span>
            <div class="w-full h-3 bg-gray-700 rounded-full overflow-hidden border border-white/20">
                <div id="bar-hunger" class="h-full bg-green-500 w-full stat-bar-fill"></div>
            </div>
        </div>
        <div class="flex flex-col items-center w-1/4">
            <span class="text-xl mb-1">üöø</span>
            <div class="w-full h-3 bg-gray-700 rounded-full overflow-hidden border border-white/20">
                <div id="bar-clean" class="h-full bg-green-500 w-full stat-bar-fill"></div>
            </div>
        </div>
        <div class="flex flex-col items-center w-1/4">
            <span class="text-xl mb-1">üòÇ</span>
            <div class="w-full h-3 bg-gray-700 rounded-full overflow-hidden border border-white/20">
                <div id="bar-fun" class="h-full bg-green-500 w-full stat-bar-fill"></div>
            </div>
        </div>
        <div class="flex flex-col items-center w-1/4">
            <span class="text-xl mb-1">üò¥</span>
            <div class="w-full h-3 bg-gray-700 rounded-full overflow-hidden border border-white/20">
                <div id="bar-sleep" class="h-full bg-green-500 w-full stat-bar-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Game Scene -->
    <div id="game-bg" class="absolute inset-0 bg-gradient-to-b from-blue-300 to-green-200 -z-10"></div>
    
    <!-- Room Decor -->
    <div id="room-decor" class="absolute top-20 w-full flex justify-center opacity-50 pointer-events-none">
        <!-- Living Room Window -->
        <div class="w-32 h-32 bg-sky-200 border-4 border-white rounded-lg relative overflow-hidden hidden" id="decor-living">
            <div class="absolute top-2 left-2 w-4 h-4 bg-yellow-300 rounded-full shadow-[0_0_10px_yellow]"></div>
            <div class="w-full h-1 bg-white absolute top-1/2"></div>
            <div class="h-full w-1 bg-white absolute left-1/2"></div>
        </div>
    </div>

    <!-- Shower Head (Hidden by default) -->
    <div id="shower-head" class="absolute top-10 left-1/2 -translate-x-1/2 transition-transform duration-500 -translate-y-40 z-10">
        <svg width="60" height="80" viewBox="0 0 60 80">
            <path d="M20 0 V 40 Q 20 60 40 60 H 50" stroke="silver" stroke-width="8" fill="none"/>
            <path d="M30 60 L 60 80 L 0 80 Z" fill="silver" />
            <!-- Water Streams -->
            <g class="water-stream hidden" stroke="#60A5FA" stroke-width="2" stroke-dasharray="5 5">
                <line x1="10" y1="80" x2="10" y2="200" style="animation: waterFlow 0.5s linear infinite"/>
                <line x1="30" y1="80" x2="30" y2="200" style="animation: waterFlow 0.4s linear infinite"/>
                <line x1="50" y1="80" x2="50" y2="200" style="animation: waterFlow 0.6s linear infinite"/>
            </g>
        </svg>
    </div>

    <!-- The Cat Character -->
    <div id="scene-container" class="relative w-full h-full flex items-end justify-center pb-32 overflow-hidden">
        
        <!-- Microphone Status Bubble -->
        <div id="mic-indicator" class="absolute top-1/4 right-4 bg-white/90 p-3 rounded-xl rounded-tr-none shadow-lg transform transition-all duration-300 opacity-0 scale-75">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                <span class="text-sm font-bold text-gray-700" id="mic-text">Listening...</span>
            </div>
        </div>

        <!-- Cat SVG -->
        <div id="cat" class="w-72 h-80 sm:w-80 sm:h-96 relative cat-idle cursor-pointer tap-highlight-transparent">
            <!-- Sleep ZZZs -->
            <div id="zzz-particles" class="absolute -top-16 right-10 hidden">
                <span class="text-white font-bold text-4xl animate-bounce" style="animation-duration: 2s">Z</span>
                <span class="text-white font-bold text-2xl animate-bounce absolute -top-4 -right-4" style="animation-duration: 2.5s">z</span>
            </div>

            <svg viewBox="0 0 200 220" class="w-full h-full drop-shadow-2xl">
                <!-- Tail -->
                <path d="M100 190 Q 160 210 170 150" stroke="#fb923c" stroke-width="18" fill="none" stroke-linecap="round" class="cat-tail-anim"/>
                
                <!-- Body -->
                <ellipse cx="100" cy="150" rx="65" ry="70" fill="#fb923c" />
                <ellipse cx="100" cy="150" rx="35" ry="55" fill="#fed7aa" /> <!-- Belly -->

                <!-- Dirt Spots (Initially hidden) -->
                <g id="dirt-spots" opacity="0">
                    <circle cx="70" cy="160" r="10" fill="#78350f" opacity="0.4" />
                    <circle cx="120" cy="140" r="8" fill="#78350f" opacity="0.4" />
                    <circle cx="90" cy="180" r="12" fill="#78350f" opacity="0.4" />
                </g>

                <!-- Feet -->
                <ellipse cx="65" cy="215" rx="18" ry="12" fill="#ea580c" />
                <ellipse cx="135" cy="215" rx="18" ry="12" fill="#ea580c" />
                
                <!-- Head Group -->
                <g id="head-group">
                    <circle cx="100" cy="80" r="60" fill="#fb923c" />
                    <!-- Ears -->
                    <path d="M45 40 L 30 5 L 75 30 Z" fill="#fb923c" />
                    <path d="M155 40 L 170 5 L 125 30 Z" fill="#fb923c" />
                    <path d="M48 35 L 38 15 L 65 30 Z" fill="#fecdd3" />
                    <path d="M152 35 L 162 15 L 135 30 Z" fill="#fecdd3" />

                    <!-- Eyes -->
                    <g class="cat-eye-anim" id="eyes">
                        <ellipse cx="75" cy="70" rx="14" ry="16" fill="white" stroke="#ea580c" stroke-width="2"/>
                        <circle cx="75" cy="70" r="6" fill="black" class="pupil" />
                        <circle cx="78" cy="66" r="3" fill="white" />
                        
                        <ellipse cx="125" cy="70" rx="14" ry="16" fill="white" stroke="#ea580c" stroke-width="2"/>
                        <circle cx="125" cy="70" r="6" fill="black" class="pupil" />
                        <circle cx="128" cy="66" r="3" fill="white" />
                    </g>
                    <!-- Closed Eyes (For Sleep) -->
                    <g id="eyes-closed" display="none">
                         <path d="M65 75 Q 75 80 85 75" stroke="black" stroke-width="3" fill="none"/>
                         <path d="M115 75 Q 125 80 135 75" stroke="black" stroke-width="3" fill="none"/>
                    </g>

                    <!-- Nose & Mouth -->
                    <path d="M92 95 L 108 95 L 100 102 Z" fill="#be123c" />
                    <g class="cat-jaw">
                        <path d="M100 102 L 100 110" stroke="black" stroke-width="2" />
                        <path d="M100 110 Q 85 120 90 105" stroke="black" stroke-width="2" fill="none" />
                        <path d="M100 110 Q 115 120 110 105" stroke="black" stroke-width="2" fill="none" />
                        <!-- Inner Mouth (For talking) -->
                        <ellipse cx="100" cy="112" rx="8" ry="2" fill="#9f1239" class="cat-mouth-inner opacity-0" />
                    </g>
                    
                    <!-- Whiskers -->
                    <g stroke="black" stroke-width="1" opacity="0.4">
                        <line x1="50" y1="90" x2="20" y2="85" />
                        <line x1="50" y1="95" x2="15" y2="95" />
                        <line x1="150" y1="90" x2="180" y2="85" />
                        <line x1="150" y1="95" x2="185" y2="95" />
                    </g>
                </g>
            </svg>
        </div>
    </div>

    <!-- Control Dock -->
    <div id="controls" class="fixed bottom-4 left-4 right-4 bg-white/80 backdrop-blur-md rounded-2xl p-2 shadow-xl flex justify-around items-center z-40 hidden pb-safe">
        
        <button onclick="handleAction('eat')" class="flex flex-col items-center gap-1 active:scale-90 transition">
            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center text-2xl border-2 border-orange-300">üçî</div>
            <span class="text-xs font-bold text-gray-600">Eat</span>
        </button>

        <button onclick="handleAction('drink')" class="flex flex-col items-center gap-1 active:scale-90 transition">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-2xl border-2 border-blue-300">ü•õ</div>
            <span class="text-xs font-bold text-gray-600">Drink</span>
        </button>

        <!-- Main Mic Button -->
        <button id="mic-btn" class="relative -top-6 active:scale-95 transition">
            <div class="w-20 h-20 bg-gradient-to-tr from-rose-500 to-pink-500 rounded-full flex items-center justify-center text-4xl shadow-xl border-4 border-white text-white">
                üéôÔ∏è
            </div>
        </button>

        <button onclick="handleAction('shower')" class="flex flex-col items-center gap-1 active:scale-90 transition">
            <div class="w-12 h-12 bg-cyan-100 rounded-full flex items-center justify-center text-2xl border-2 border-cyan-300">üßº</div>
            <span class="text-xs font-bold text-gray-600">Clean</span>
        </button>

        <button onclick="handleAction('sleep')" class="flex flex-col items-center gap-1 active:scale-90 transition">
            <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center text-2xl border-2 border-indigo-300">üåô</div>
            <span class="text-xs font-bold text-gray-600">Sleep</span>
        </button>
    </div>

    <script>
        // --- Game State ---
        const state = {
            hunger: 80, // 0-100 (100 is full)
            clean: 50,  // 0-100 (100 is clean)
            fun: 80,    // 0-100 (100 is happy)
            sleep: 80,  // 0-100 (100 is wide awake)
            isSleeping: false,
            isListening: false,
            isTalking: false,
            isShowering: false
        };

        // --- DOM Elements ---
        const cat = document.getElementById('cat');
        const headGroup = document.getElementById('head-group');
        const dirtSpots = document.getElementById('dirt-spots');
        const showerHead = document.getElementById('shower-head');
        const waterStream = document.querySelector('.water-stream');
        const gameBg = document.getElementById('game-bg');
        const micIndicator = document.getElementById('mic-indicator');
        const micText = document.getElementById('mic-text');
        const startScreen = document.getElementById('start-screen');
        const controls = document.getElementById('controls');
        const uiHeader = document.getElementById('ui-header');
        
        // Bars
        const bars = {
            hunger: document.getElementById('bar-hunger'),
            clean: document.getElementById('bar-clean'),
            fun: document.getElementById('bar-fun'),
            sleep: document.getElementById('bar-sleep')
        };

        // --- Audio Context (Synth) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
        }

        function playTone(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;

            if (type === 'meow') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.4);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.3, now + 0.1);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'eat') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(150, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.15);
            } else if (type === 'happy') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1000, now);
                osc.frequency.exponentialRampToValueAtTime(1500, now + 0.2);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'sad') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.linearRampToValueAtTime(200, now + 0.5);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        }

        // --- Game Logic ---

        document.getElementById('start-btn').addEventListener('click', () => {
            initAudio();
            startScreen.style.display = 'none';
            controls.style.display = 'flex';
            uiHeader.style.display = 'flex';
            playTone('meow');
            
            // Initial Talk Request for permissions
            setupSpeech();
            
            gameLoop();
        });

        function gameLoop() {
            // Decay stats slowly
            if(!state.isSleeping) {
                state.hunger = Math.max(0, state.hunger - 0.05);
                state.clean = Math.max(0, state.clean - 0.03);
                state.fun = Math.max(0, state.fun - 0.04);
                state.sleep = Math.max(0, state.sleep - 0.02);
            } else {
                state.sleep = Math.min(100, state.sleep + 0.1);
            }

            updateUI();
            requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            bars.hunger.style.width = state.hunger + '%';
            bars.clean.style.width = state.clean + '%';
            bars.fun.style.width = state.fun + '%';
            bars.sleep.style.width = state.sleep + '%';

            // Color coding
            updateColor(bars.hunger, state.hunger);
            updateColor(bars.clean, state.clean);
            updateColor(bars.fun, state.fun);
            updateColor(bars.sleep, state.sleep);

            // Visible Dirt
            dirtSpots.style.opacity = (100 - state.clean) / 100;
        }

        function updateColor(el, val) {
            if(val < 30) el.className = 'h-full w-full stat-bar-fill bg-red-500';
            else if(val < 60) el.className = 'h-full w-full stat-bar-fill bg-yellow-400';
            else el.className = 'h-full w-full stat-bar-fill bg-green-500';
        }

        // --- Actions ---

        function handleAction(action) {
            if (state.isSleeping && action !== 'sleep') {
                spawnFloater('üí§ Wake up first!', 0, -50);
                return;
            }
            if (state.isTalking || state.isShowering) return;

            initAudio();

            switch(action) {
                case 'eat':
                    if(state.hunger >= 95) { spawnFloater('ü§¢ Full!', 0, -50); return; }
                    state.hunger = Math.min(100, state.hunger + 20);
                    animateEat('üçî');
                    break;
                case 'drink':
                    if(state.hunger >= 95) { spawnFloater('ü§¢ Full!', 0, -50); return; }
                    state.hunger = Math.min(100, state.hunger + 10);
                    animateEat('ü•õ');
                    break;
                case 'shower':
                    if(state.clean >= 95) { spawnFloater('‚ú® Already Clean!', 0, -50); return; }
                    startShower();
                    break;
                case 'sleep':
                    toggleSleep();
                    break;
            }
        }

        function animateEat(emoji) {
            cat.classList.add('chewing');
            spawnFloater(emoji, 20, 50);
            
            // Crunch sounds
            let count = 0;
            const crunch = setInterval(() => {
                playTone('eat');
                count++;
                if(count > 4) {
                    clearInterval(crunch);
                    cat.classList.remove('chewing');
                    playTone('happy');
                    spawnFloater('üòã', 0, -80);
                }
            }, 200);
        }

        function startShower() {
            state.isShowering = true;
            gameBg.classList.replace('from-blue-300', 'from-cyan-100');
            
            // Lower shower head
            showerHead.style.transform = "translate(-50%, 0)";
            
            setTimeout(() => {
                waterStream.classList.remove('hidden');
                cat.classList.add('shower-active');
                
                // Cleaning process
                const cleanInterval = setInterval(() => {
                    state.clean = Math.min(100, state.clean + 5);
                    playTone('eat'); // reuse noise for water splash
                    if(state.clean >= 100) {
                        clearInterval(cleanInterval);
                        finishShower();
                    }
                }, 200);
            }, 500);
        }

        function finishShower() {
            waterStream.classList.add('hidden');
            showerHead.style.transform = "translate(-50%, -10rem)";
            cat.classList.remove('shower-active');
            gameBg.classList.replace('from-cyan-100', 'from-blue-300');
            state.isShowering = false;
            playTone('happy');
            spawnFloater('‚ú® Clean!', 0, -80);
        }

        function toggleSleep() {
            state.isSleeping = !state.isSleeping;
            const eyes = document.getElementById('eyes');
            const eyesClosed = document.getElementById('eyes-closed');
            const zzz = document.getElementById('zzz-particles');

            if(state.isSleeping) {
                // Night mode
                gameBg.classList.add('brightness-50');
                eyes.style.display = 'none';
                eyesClosed.style.display = 'block';
                zzz.style.display = 'block';
                stopListening();
                cat.classList.remove('cat-idle'); // Stop breathing heavily
            } else {
                // Day mode
                gameBg.classList.remove('brightness-50');
                eyes.style.display = 'block';
                eyesClosed.style.display = 'none';
                zzz.style.display = 'none';
                setupSpeech(); // Resume listening
                cat.classList.add('cat-idle');
                playTone('meow');
            }
        }

        // --- Interaction (Touch/Click) ---
        cat.addEventListener('click', (e) => {
            if(state.isSleeping) {
                toggleSleep();
                return;
            }
            if(state.isShowering) return;

            const rect = cat.getBoundingClientRect();
            const y = e.clientY - rect.top;

            // Head tap
            if(y < rect.height / 2) {
                cat.style.animation = 'shake 0.5s';
                playTone('sad');
                spawnFloater('ü§ï', 0, -60);
                state.fun -= 5;
                setTimeout(() => cat.style.animation = '', 500);
            } 
            // Belly tap
            else {
                cat.style.animation = 'jump 0.5s';
                playTone('happy');
                spawnFloater('‚ù§Ô∏è', 0, -60);
                state.fun = Math.min(100, state.fun + 10);
                setTimeout(() => cat.style.animation = '', 500);
            }
        });

        // --- Helper: Floating Emojis ---
        function spawnFloater(text, x, y) {
            const el = document.createElement('div');
            el.innerText = text;
            el.className = 'floater text-4xl font-bold absolute';
            // Center relative to cat
            const catRect = cat.getBoundingClientRect();
            el.style.left = (catRect.width / 2 + x) + 'px';
            el.style.top = (catRect.height / 2 + y) + 'px';
            
            cat.appendChild(el);
            setTimeout(() => el.remove(), 1500);
        }

        // --- SPEECH SYSTEM (Tom Style) ---
        let recognition;
        const synth = window.speechSynthesis;
        const micBtn = document.getElementById('mic-btn');

        function setupSpeech() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                micText.innerText = "Mic Not Supported";
                micIndicator.style.opacity = 1;
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US'; // Works best generally
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                if(state.isSleeping || state.isTalking) return;
                state.isListening = true;
                micIndicator.style.opacity = 1;
                micText.innerText = "I'm listening...";
                micBtn.classList.add('animate-pulse');
            };

            recognition.onend = () => {
                state.isListening = false;
                micBtn.classList.remove('animate-pulse');
                // Auto restart listening if idle
                if (!state.isSleeping && !state.isTalking) {
                   // Small delay to prevent CPU hogging
                   setTimeout(() => {
                       try { recognition.start(); } catch(e){}
                   }, 300);
                }
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                micText.innerText = "Processing...";
                repeatVoice(text);
            };

            micBtn.addEventListener('click', () => {
                try { recognition.start(); } catch(e) { recognition.stop(); }
            });
            
            // Initial start
            try { recognition.start(); } catch(e) {}
        }

        function stopListening() {
            if(recognition) recognition.stop();
            micIndicator.style.opacity = 0;
        }

        function repeatVoice(text) {
            state.isTalking = true;
            stopListening();
            
            const utter = new SpeechSynthesisUtterance(text);
            utter.pitch = 2.0; // High pitch like a kitten/Tom
            utter.rate = 1.3;  // Slightly fast
            utter.volume = 1;

            // Lip Sync Animation trigger
            cat.classList.add('talking');
            document.querySelector('.cat-mouth-inner').style.opacity = 1;

            utter.onend = () => {
                state.isTalking = false;
                cat.classList.remove('talking');
                document.querySelector('.cat-mouth-inner').style.opacity = 0;
                micText.innerText = "Listening...";
                // Resume listening loop
                setTimeout(() => {
                     try { recognition.start(); } catch(e){}
                }, 200);
            };

            synth.speak(utter);
        }

    </script>
</body>
</html>


